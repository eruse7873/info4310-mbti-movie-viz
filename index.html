<html lang="en">

<head>
    <title>MBTI</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        .display {
            display: flex;
            justify-content: space-between;
            height: 300px;
            width: 500;
            margin-left: 10px;
            margin-right: 10px;
        }


        .individual {
            align-self: center;
        }

        .individual img {
            cursor: pointer;
        }

        .individual:first-child {
            margin-left: 25;
        }

        .individual:last-child {
            margin-right: 100;
        }

        .avatar_selector {
            height: 300px;
            width: 550px;
            display: flex;
        }


        .hidden {
            display: none;
        }

        .gridlines .domain {
            display: none;
        }

        .contains_triangle {
            align-self: center;
        }

        .triangle {
            cursor: pointer;
        }
    </style>

    <link rel="stylesheet" href="style.css">
</head>

<body>


    <div class="avatar_selector">
        <!-- <svg id="avatar_display" height="300" width="550"></svg> -->

        <div class="active analysts display">
            <div class="individual">
                <h6 style="text-align: center">Architect</h6>
                <img class="analyst avatars" src="avatars/architect.png">
                <h6 style="text-align: center">INTJ</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Logician</h6>
                <img class="analyst avatars" src="avatars/logician.png">
                <h6 style="text-align: center">INTP</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Commander</h6>
                <img class="analyst avatars" src="avatars/commander.png">
                <h6 style="text-align: center">ENTJ</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Debater</h6>
                <img class="analyst avatars" src="avatars/debater.png">
                <h6 style="text-align: center">ENTP</h6>
            </div>
        </div>

        <div class="hidden diplomats display">
            <div class="individual">
                <h6 style="text-align: center">Advocate</h6>
                <img class="diplomats avatars" src="avatars/advocate.png">
                <h6 style="text-align: center">INFJ</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Mediator</h6>
                <img class="diplomats avatars" src="avatars/mediator.png">
                <h6 style="text-align: center">INFP</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Protagonist</h6>
                <img class="diplomats avatars" src="avatars/protagonist.png">
                <h6 style="text-align: center">ENFJ</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Campaigner</h6>
                <img class="diplomats avatars" src="avatars/campaigner.png">
                <h6 style="text-align: center">ENFP</h6>
            </div>
        </div>

        <div class="hidden sentinels display">
            <div class="individual">
                <h6 style="text-align: center">Logistician</h6>
                <img class="sentinels avatars" src="avatars/logistician.png">
                <h6 style="text-align: center">ISTJ</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Defender</h6>
                <img class="sentinels avatars" src="avatars/defender.png">
                <h6 style="text-align: center">ISFJ</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Executive</h6>
                <img class="sentinels avatars" src="avatars/executive.png">
                <h6 style="text-align: center">ESTJ</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Consul</h6>
                <img class="sentinels avatars" src="avatars/consul.png">
                <h6 style="text-align: center">ESFJ</h6>
            </div>
        </div>

        <div class="hidden explorers display">
            <div class="individual">
                <h6 style="text-align: center">Virtuoso</h6>
                <img class="explorers avatars" src="avatars/virtuoso.png">
                <h6 style="text-align: center">ISTP</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Adventurer</h6>
                <img class="explorers avatars" src="avatars/adventurer.png">
                <h6 style="text-align: center">ISFP</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Entrepreneur</h6>
                <img class="explorers avatars" src="avatars/entrepreneur.png">
                <h6 style="text-align: center">ESTP</h6>
            </div>
            <div class="individual">
                <h6 style="text-align: center">Entrepreneur</h6>
                <img class="explorers avatars" src="avatars/entertainer.png">
                <h6 style="text-align: center">ESFP</h6>
            </div>
        </div>
        <div class='contains_triangle'>
            <img class='triangle' src="triangle.png" width="32" height="37">
        </div>
    </div>

    <svg id="enneagramSelector" height="600" width="600"></svg>
    <svg id="barchart" height="800" width="800" style="margin:50px"></svg>
    <script>


        let origin = 300;
        let radius = 150;
        const enneagramSelector = d3.select("svg#enneagramSelector");
        enneagramSelector.append("circle")
            .attr("cx", origin)
            .attr('cy', origin)
            .attr('r', radius)
            .attr('stroke', 'none')
            .attr('fill', 'none');
        // let nodes = {"1":0, "2":40, "3":80, "4":120, "5":160, "6":200, "7":240, "8":280, "9":320}

        let nodeIDs = [1, 2, 3, 4, 5, 6, 7, 8, 9];
        let nodeDegree = [0, 40, 80, 120, 160, 200, 240, 280, 320];
        let nodeColor = ['#27749C', '#2FB478', '#6DCD38', '#E6C742', '#FF4C58', '#F856BD', '#D460F1', '#886AEA', '#7399E4', '#7CD4DD']
        // nodes = nodes.map(x=>{node:x})
        // const nodes = nodeID.map((x, i)=> ({}))
        nodes = []
        for (let i = 0; i < nodeIDs.length; i++) {
            dict = { nodeID: nodeIDs[i], degree: nodeDegree[i], color: nodeColor[i] };
            nodes.push(dict);
        }

        console.log(nodes);

        // var enneagramSelectorAnnotations = enneagramSelector.append('g');

        let circles = enneagramSelector.selectAll('g.circleNodes').data(nodes)
            .join('g')
            .attr('class', 'circleNode')
            .attr('transform', d => `rotate(${d.degree},${origin},${origin})`)

        nodeCircles = circles.append('circle')
            // SOURCE: drawing circles around a circle
            // https://spin.atomicobject.com/2015/06/12/objects-around-svg-circle-d3-js/
            .attr('class', 'circle.node')
            .join('circle')
            .attr('r', 20)
            .attr('fill', d => d.color)
            .attr('cx', origin + (radius * Math.sin(0)))
            .attr('cy', origin - (radius * Math.cos(0)))
        // .attr('transform', d => `rotate(${d.degree},${origin},${origin})`);

        nodeLabels = circles.append('text')
            .text(d => d.nodeID)
            .attr('text-anchor', 'middle')
            .attr('alignment-baseline', 'middle')
            .style('font-size', '20px')
            .attr('fill', 'white')
            .attr('x', origin + (radius * Math.sin(0)))
            .attr('y', origin - (radius * Math.cos(0)))

        nodeCircles
            .on('mouseover', function () {
                let enn = d3.select(this);
                console.log(enn);
                enn.transition().duration(100)
                    .attr("stroke-width", 4)
                    .style("stroke-opacity", .8)
                    .style("stroke", 'black')
            })
            .on('mouseout', function () {
                // if (clicked != true) {
                let enn = d3.select(this);
                console.log(enn);
                enn.transition().duration(200)
                    .attr("stroke-width", 0)
                // }

            })
        // .on('click', function () {
        //     let enn = d3.select(this);
        //     console.log(enn);
        //     enn.attr('stroke', 'black')
        //     enn.attr('stroke-width', 3);
        //     return clicked;
        // })


        const svg = d3.select("svg#barchart");
        const width = svg.attr("width");
        const height = svg.attr("height");
        const margin = { top: 10, right: 10, bottom: 50, left: 150 };
        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom;

        const getCompatibility = async function () {
            let data = await d3.csv("mbti_clean.csv");
            console.log(data);

            d3.select(".triangle")
                .on('click', changeAvatars);

            function changeAvatars() {
                if (d3.selectAll(".analysts").classed("active")) {

                    d3.selectAll(".analysts")
                        .classed("active", false);
                    d3.selectAll(".analysts")
                        .classed("hidden", true);

                    d3.selectAll(".diplomats")
                        .classed("active", true);
                    d3.selectAll(".diplomats")
                        .classed("hidden", false);
                }


                else if (d3.selectAll(".diplomats").classed("active")) {

                    d3.selectAll(".diplomats")
                        .classed("active", false);
                    d3.selectAll(".diplomats")
                        .classed("hidden", true);

                    d3.selectAll(".sentinels")
                        .classed("active", true);
                    d3.selectAll(".sentinels")
                        .classed("hidden", false);
                }

                else if (d3.selectAll(".sentinels").classed("active")) {

                    d3.selectAll(".sentinels")
                        .classed("active", false);
                    d3.selectAll(".sentinels")
                        .classed("hidden", true);

                    d3.selectAll(".explorers")
                        .classed("active", true);
                    d3.selectAll(".explorers")
                        .classed("hidden", false);
                }

                else if (d3.selectAll(".explorers").classed("active")) {

                    d3.selectAll(".explorers")
                        .classed("active", false);
                    d3.selectAll(".explorers")
                        .classed("hidden", true);

                    d3.selectAll(".analysts")
                        .classed("active", true);
                    d3.selectAll(".analysts")
                        .classed("hidden", false);
                }
            }

            d3.selectAll(".individual")
                .on("click", chooseMBTI);

            function chooseMBTI() {
                input_mbti = d3.select(this).selectAll("h6:last-child").text()

                getCharacterInfo(input_mbti)
               // mbtiBars(input_mbti);
            }


            // getCharacterInfo is a function that returns an 
            function getCharacterInfo(input_mbti) {
                // let input_mbti = input_mbti;

                // new object array compat contains role, movie and a compat score (0-4) based on mbti similarity
                var compat = [];

                // loop through each character
                for (let x = 0; x < data.length; x++) {

                    // reset compatibility count to 0 for each new character
                    count = 0;

                    // loop through mbti of each character
                    for (let i = 0; i < 4; i++) {

                        // get a count for compatibility
                        if (input_mbti.charAt(i) === data[x]['mbti'].charAt(i)) {
                            count += 1;
                        }
                    }

                    // create array of character name, movie title, and compatibility
                    // push to object array
                    let info = [data[x]['role'], data[x]['movie'], count];
                    compat.push(info);

                }

                console.log(compat);

                function getRandomCharacter(arr) {
                    const randomIndex = Math.floor(Math.random() * arr.length);
                    let character = arr[randomIndex];
                    return character;
                }

                // get random characters from each compat score

                // new arrays for each of the different compat scores
                compat0 = [];
                compat25 = [];
                compat50 = [];
                compat75 = [];
                compat100 = [];

                for (let x = 0; x < compat.length; x++) {
                    if (compat[x]['2'] === 0) {
                        compat0.push([compat[x]['0'], compat[x]['1'], compat[x]['2']]);
                    }
                    else if (compat[x]['2'] === 1) {
                        compat25.push([compat[x]['0'], compat[x]['1'], compat[x]['2']]);
                    }
                    else if (compat[x]['2'] === 2) {
                        compat50.push([compat[x]['0'], compat[x]['1'], compat[x]['2']]);
                    }
                    else if (compat[x]['2'] === 3) {
                        compat75.push([compat[x]['0'], compat[x]['1'], compat[x]['2']]);
                    }
                    else if (compat[x]['2'] === 4) {
                        compat100.push([compat[x]['0'], compat[x]['1'], compat[x]['2']]);
                    }
                }

                console.log(compat0);


                // graphNames contains one random character from each mbti compat

                var graphNames = [];
                graphNames.push(getRandomCharacter(compat0));
                graphNames.push(getRandomCharacter(compat25));
                graphNames.push(getRandomCharacter(compat50));
                graphNames.push(getRandomCharacter(compat75));
                graphNames.push(getRandomCharacter(compat100));

                console.log(graphNames);

                return graphNames;
            }


            // making bar chart
            let annotations = svg.append("g").attr("id", "annotations");
            let chartArea = svg.append("g").attr("id", "points")
                .attr("transform", `translate(${margin.left},${margin.top})`);


            // intial left axis and gridlines, leave it to update later

            leftAxisScale = d3.scaleBand().domain(["0%", "25%", "50%", "75%", "100%"]).range([chartHeight, 0]);


            let leftAxis = d3.axisLeft(leftAxisScale);
            annotations.append("g")
                .attr("class", "y axis")
                .call(leftAxis)
                .attr("transform", `translate(${margin.left}, ${margin.top + 10})`);

            // initial bottom axis and gridlines because these don't change           
            const rankScale = d3.scaleLinear().domain([0, 4]).range([0, chartWidth]);

            let bottomAxis = d3.axisBottom(rankScale).ticks(4);
            // maybe get rid of this laters
            let bottomAxisG = d3.axisBottom(rankScale).tickSize(-chartHeight - 10).tickFormat("").ticks(4);

            annotations.append("g")
                .attr("class", "x axis")
                .attr("transform", `translate(${margin.left},${chartHeight + margin.top + 10})`)
                .call(bottomAxis);

            // annotations.append("g")
            //     .attr("class", "x gridlines")
            //     .attr("transform", `translate(${margin.left}, ${chartHeight + margin.top + 10})`)
            //     .call(bottomAxisG);


            // function mbtiBars(mbti) {



            //     const data =

            //         console.log(data)
            //     const characterScale = d3.scaleBand().domain(topRandomCharactersNames).range([chartHeight, 0])
            //         .padding(0.05);



            //     // Update and animate axes

            //     annotations.append("g")
            //         .attr("class", "y axis")
            //         .attr("transform", `translate(${margin.left - 10},${margin.top})`)
            //         .call(leftAxis)
            //     annotations.append("g")
            //         .attr("class", "y gridlines")
            //         .attr("transform", `translate(${margin.left - 10},${margin.top})`)
            //         .call(leftGridlines);


            //     chartArea.selectAll('rect.bar').data(data, d => d['genre'])
            //         .join(enter => enter.append('rect')
            //             .attr('class', 'bar')
            //             .attr("fill", "steelblue")
            //             .attr("x", d => genreScale(d.genre))
            //             .attr("y", d => percentScale(d.percentpass))
            //             .attr("height", d => percentScale(0) - percentScale(d.percentpass))
            //             .attr("width", genreScale.bandwidth())
            //             .attr("opacity", 0) // Set opacity low, then animate to 1 to make them fade in
            //             .call(enter => enter.transition()
            //                 .attr('opacity', 1)),
            //             update => update.call(update => update.transition()  // Animate resizing and movement
            //                 .attr("fill", "steelblue")
            //                 .attr("x", d => genreScale(d.genre))
            //                 .attr("y", d => percentScale(d.percentpass))
            //                 .attr("height", d => percentScale(0) - percentScale(d.percentpass))
            //                 .attr("width", genreScale.bandwidth())),
            //             exit => exit.call(exit => exit.transition().attr('opacity', 0).remove())); // Animate opacity to fade out


            // }


        }


        getCompatibility();


    </script>
</body>

</html>